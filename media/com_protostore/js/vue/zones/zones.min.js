// @license   http://www.gnu.org/licenses/gpl.html GNU/GPL
const p2s_zones={data:()=>({base_url:"",items:[],itemsChunked:[],currentSort:"name",currentSortDir:"asc",currentPage:0,pages:[],countries:[],pagesizes:[5,10,15,20,25,30,50,100,200,500],show:25,enteredText:"",publishedOnly:!1,selectedCountry:0,selected:[],confirm_LangString:""}),async beforeMount(){const e=document.getElementById("base_url");this.base_url=e.innerText,e.remove();const t=document.getElementById("items_data");try{this.items=JSON.parse(t.innerText),t.remove()}catch(e){}const s=document.getElementById("countries_data");try{this.countries=JSON.parse(s.innerText)}catch(e){}const r=document.getElementById("page_size");this.show=r.innerText,r.remove();const i=document.getElementById("confirmLangString");try{this.confirm_LangString=i.innerText,i.remove()}catch(e){}},mounted:function(){this.changeShow()},computed:{last5(){return Number(this.itemsChunked.length-5)}},methods:{async updateList(){const e=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=zones.updatelist&format=raw&limit=0",{method:"post"});(await e.json()).success||UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},async filter(){this.loading=!0;const e={limit:this.show,offset:this.currentPage*this.show,searchTerm:this.enteredText?this.enteredText.trim():"",publishedOnly:this.publishedOnly,country_id:this.selectedCountry},t=this.serialize(e),s=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=zones.filter&format=raw&"+t,{method:"post"}),r=await s.json();r.success&&(this.items=r.data.zones,this.loading=!1,this.items?this.changeShow():(this.itemsChunked=[],this.pages=1,this.currentPage=0))},changeShow(){this.itemsChunked=this.items.reduce(((e,t,s)=>{const r=Math.floor(s/this.show);return e[r]||(e[r]=[]),e[r].push(t),e}),[]),this.pages=this.itemsChunked.length,this.currentPage=0},changePage(e){this.currentPage=e},cleartext(){this.enteredText=null,this.doTextSearch()},async doTextSearch(e){clearTimeout(this.debounce),this.debounce=setTimeout((()=>{this.filter()}),600)},sort(e){return e===this.currentSort&&(this.currentSortDir="asc"===this.currentSortDir?"desc":"asc"),this.currentSort=e,this.itemsChunked[this.currentPage].sort(((e,t)=>{let s=1;return"desc"===this.currentSortDir&&(s=-1),e[this.currentSort]<t[this.currentSort]?-1*s:e[this.currentSort]>t[this.currentSort]?1*s:0}))},async togglePublished(e){this.selected=[],this.selected.push(e),this.toggleSelected()},async toggleSelected(){this.selected.forEach((e=>{e.published^=1}));const e={items:this.selected},t=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=zones.togglePublished&format=raw",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)});(await t.json()).success?(UIkit.notification({message:"Status changed",status:"success",pos:"top-center",timeout:5e3}),this.selected=[],await this.filter()):UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},async trashSelected(){await UIkit.modal.confirm("<h5>"+this.confirm_LangString+"</h5>");const e={items:this.selected},t=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=zones.trash&format=raw",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)});(await t.json()).success?await this.filter():UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},selectAll(e){e.target.checked?this.selected=this.itemsChunked[this.currentPage]:this.selected=[]},serialize(e){var t=[];for(var s in e)e.hasOwnProperty(s)&&t.push(encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t.join("&")}},components:{"p-inputswitch":primevue.inputswitch}};Vue.createApp(p2s_zones).mount("#p2s_zones");