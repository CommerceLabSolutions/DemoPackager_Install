// @license   http://www.gnu.org/licenses/gpl.html GNU/GPL
const p2s_email_form={data:()=>({form:{jform_id:"",jform_to:"",jform_subject:"",jform_emailtype:"",jform_body:"",jform_language:"*",jform_published:!0},andClose:!1,copytext:""}),created(){},mounted(){},computed(){},async beforeMount(){const e=document.getElementById("p2s_email");try{const t=JSON.parse(e.innerText);this.form.jform_id=t.id,this.form.jform_to=t.to,this.form.jform_subject=t.subject,this.form.jform_emailtype=t.emailtype,this.form.jform_body=t.body,this.form.jform_language=t.language,this.form.jform_published=t.published}catch(e){}const t=document.getElementById("base_url");try{this.base_url=t.innerText,t.remove()}catch(e){}const o=document.getElementById("currency");try{this.currency=o.innerText,o.remove()}catch(e){}const r=document.getElementById("locale");try{this.locale=r.innerText,r.remove()}catch(e){}},methods:{toggle(){console.log(this.hasErroraccess),this.hasErroraccess=!this.hasErroraccess},async saveItem(){this.form.jform_body=this.getFrameContents("jform_body"),console.log(this.form);const e={itemid:this.form.jform_id,to:this.form.jform_to,subject:this.form.jform_subject,emailtype:this.form.jform_emailtype,body:this.form.jform_body,language:this.form.jform_language,published:this.form.jform_published?1:0};console.log(JSON.stringify(e));const t=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=email.save&format=raw",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)}),o=await t.json();if(o.success)if(UIkit.notification({message:"Saved!",status:"success",pos:"top-right",timeout:5e3}),this.andClose)window.location.href=this.base_url+"index.php?option=com_protostore&view=emailmanager";else{const e=window.location.href;-1==e.indexOf("&id=")&&history.replaceState("","",e+"&id="+o.data.id),this.form.jform_id=o.data.id}else UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},getFrameContents(e){const t=document.getElementById(e+"_ifr");let o;return t.contentDocument?o=t.contentDocument.getElementById("tinymce"):t.contentWindow&&(o=t.contentWindow.document.getElementById("tinymce")),o.innerHTML},serialize(e){var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")},copyText(e){let t=document.querySelector("#copytext");t.setAttribute("type","text"),t.value=e,t.select();try{document.execCommand("copy"),UIkit.notification({message:e+" Copied",status:"primary",pos:"top-center",timeout:2500})}catch(e){alert("Oops, unable to copy")}t.setAttribute("type","hidden"),window.getSelection().removeAllRanges()}},components:{"p-inputswitch":primevue.inputswitch}};Vue.createApp(p2s_email_form).mount("#p2s_email_form");