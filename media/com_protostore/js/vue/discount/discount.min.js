// @license   http://www.gnu.org/licenses/gpl.html GNU/GPL
const p2s_discount_form={data:()=>({base_url:"",form:{jform_id:"",jform_name:"",jform_coupon_code:"",jform_amount:"",jform_percentage:"",jform_discount_type:"",jform_published:"",jform_start_date:"",jform_expiry_date:"",jform_max_usage:"",jform_user_id:"",jform_created:"",jform_modified:"",jform_created_by:"",jform_modified_by:"",jform_discount_type_string:""},andClose:!1,p2s_currency:[],p2s_local:!1}),mounted(){console.log(this.p2s_currency)},computed:{},async beforeMount(){await this.setData(),this.form.jform_amount=this.form.jform_amount/100,1==this.form.jform_discount_type&&(this.form.jform_discount_type=1);const e=document.getElementById("base_url");this.base_url=e.innerText,e.remove();const t=document.getElementById("currency");if(null!=t)try{this.p2s_currency=JSON.parse(t.innerText)}catch(e){}const o=document.getElementById("locale");if(null!=o)try{this.p2s_local=o.innerText}catch(e){}},methods:{async saveItem(){const e={itemid:this.form.jform_id,name:this.form.jform_name,coupon_code:this.form.jform_coupon_code,amount:100*this.form.jform_amount,percentage:this.form.jform_percentage,discount_type:this.form.jform_discount_type,start_date:this.form.jform_start_date,expiry_date:this.form.jform_expiry_date,max_usage:this.form.jform_max_usage,user_id:this.form.jform_user_id,published:this.form.jform_published?1:0},t=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=discount.save&format=raw",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)}),o=await t.json();if(o.success)if(UIkit.notification({message:"Saved!",status:"success",pos:"top-right",timeout:5e3}),this.andClose)window.location.href=this.base_url+"index.php?option=com_protostore&view=discounts";else{const e=window.location.href;-1==e.indexOf("&id=")&&history.replaceState("","",e+"&id="+o.data.id),this.form.jform_id=o.data.id}else UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},setData(){Object.keys(this.form).forEach((e=>{let t=document.getElementById(e+"_data");t&&(this.hasJsonStructure(t.innerText)?(console.log(JSON.parse(t.innerText)),this.form[e]=JSON.parse(t.innerText)):(console.log(t),this.form[e]=t.innerText,"1"===t.innerText&&(this.form[e]=!0),"0"===t.innerText&&(this.form[e]=!1)))}))},hasJsonStructure(e){if("string"!=typeof e)return!1;try{const t=JSON.parse(e),o=Object.prototype.toString.call(t);return"[object Object]"===o||"[object Array]"===o}catch(e){return!1}},serialize(e){var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")}},components:{"p-inputswitch":primevue.inputswitch,"p-inputnumber":primevue.inputnumber,"p-inputtext":primevue.inputtext,"p-calendar":primevue.calendar,"p-config":primevue.config}};Vue.createApp(p2s_discount_form).use(primevue.config.default).mount("#p2s_discount_form");