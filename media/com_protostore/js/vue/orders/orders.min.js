// @license   http://www.gnu.org/licenses/gpl.html GNU/GPL
const p2s_orders={data:()=>({base_url:"",items:[],itemsChunked:[],currentSort:"title",currentSortDir:"asc",currentPage:0,pages:[],pagesizes:[5,10,15,20,25,30,50,100,200,500],statuses:[],show:25,selectedStatus:0,dateFrom:"",dateTo:""}),async beforeMount(){const t=document.getElementById("base_url");this.base_url=t.innerText,t.remove();const e=document.getElementById("items_data");try{this.items=JSON.parse(e.innerText)}catch(t){}const s=document.getElementById("statuses_data");try{this.statuses=JSON.parse(s.innerText),s.remove()}catch(t){}const r=document.getElementById("page_size");this.show=r.innerText,r.remove()},mounted:function(){this.changeShow()},computed:{dateActive(){return""!==this.dateFrom&&""!==this.dateTo}},methods:{async updateList(){const t=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=orders.updatelist&format=raw&limit=0",{method:"post"});(await t.json()).success||UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},async filter(){this.loading=!0,UIkit.drop("#ordersDateDrop").hide();const t={limit:this.show,offset:this.currentPage*this.show,searchTerm:this.enteredText?this.enteredText.trim():"",status:this.selectedStatus,dateFrom:this.dateFrom,dateTo:this.dateTo},e=this.serialize(t),s=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=order.filter&format=raw&"+e,{method:"post"}),r=await s.json();r.success&&(this.items=r.data.items,this.loading=!1,this.items?this.changeShow():(this.itemsChunked=[],this.pages=1,this.currentPage=0))},changeShow(){this.items&&(this.itemsChunked=this.items.reduce(((t,e,s)=>{const r=Math.floor(s/this.show);return t[r]||(t[r]=[]),t[r].push(e),t}),[]),this.pages=this.itemsChunked.length,this.currentPage=0)},changePage(t){this.currentPage=t},setDateBand(t){const e=this.convertDate(new Date(Date.now())),s=this.convertDate(new Date(Date.now()-24*t*60*60*1e3));this.dateFrom=s,this.dateTo=e,this.filter()},clearSearch(){this.clearDates(),this.cleartext(),this.selectedStatus=0,this.filter()},clearDates(){this.dateFrom="",this.dateTo="",this.filter()},cleartext(){this.enteredText=null,this.doTextSearch()},async doTextSearch(t){clearTimeout(this.debounce),this.debounce=setTimeout((()=>{this.filter()}),600)},convertDate:t=>t.toLocaleDateString("fr-CA"),togglePaid(t){},sort(t){return t===this.currentSort&&(this.currentSortDir="asc"===this.currentSortDir?"desc":"asc"),this.currentSort=t,this.itemsChunked[this.currentPage].sort(((t,e)=>{let s=1;return"desc"===this.currentSortDir&&(s=-1),t[this.currentSort]<e[this.currentSort]?-1*s:t[this.currentSort]>e[this.currentSort]?1*s:0}))},serialize(t){var e=[];for(var s in t)t.hasOwnProperty(s)&&e.push(encodeURIComponent(s)+"="+encodeURIComponent(t[s]));return e.join("&")}}};Vue.createApp(p2s_orders).mount("#p2s_orders");