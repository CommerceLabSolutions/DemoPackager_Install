// @license   http://www.gnu.org/licenses/gpl.html GNU/GPL
const p2s_shippingratescountry={data:()=>({base_url:"",p2s_currency:"",p2s_locale:"",items:[],itemsChunked:[],countries:[],currentSort:"name",currentSortDir:"asc",currentPage:0,pages:[],pagesizes:[5,10,15,20,25,30,50,100,200,500],show:25,enteredText:"",publishedOnly:!1,selected:[],selectedCountry:0,confirm_LangString:""}),async beforeMount(){const t=document.getElementById("base_url");try{this.base_url=t.innerText,t.remove()}catch(t){}const e=document.getElementById("currency");try{this.p2s_currency=JSON.parse(e.innerText)}catch(t){}const s=document.getElementById("locale");try{this.p2s_local=s.innerText}catch(t){}const i=document.getElementById("items_data");try{this.items=JSON.parse(i.innerText)}catch(t){}const r=document.getElementById("countries_data");try{this.countries=JSON.parse(r.innerText)}catch(t){}const n=document.getElementById("page_size");try{this.show=n.innerText,n.remove()}catch(t){}const o=document.getElementById("confirmLangString");try{this.confirm_LangString=o.innerText,o.remove()}catch(t){}},mounted:function(){this.changeShow()},computed:{},methods:{async save(t){const e={item:JSON.stringify(t)},s=this.serialize(e),i=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=shippingratescountry.save&format=raw&"+s,{method:"post"});(await i.json()).success?(await this.filter(),t.showEdit=!1,UIkit.notification({message:"Saved",status:"success",pos:"top-center",timeout:5e3})):UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},cancel(){this.filter()},async trashSelected(){await UIkit.modal.confirm(this.confirm_LangString);const t={items:this.selected},e=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=shippingratescountry.trash&format=raw",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(t)});(await e.json()).success?(UIkit.notification({message:"Item trashed",status:"success",pos:"top-center",timeout:5e3}),this.selected=[],await this.filter()):UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},async toggleSelected(){const t={items:this.selected},e=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=shippingratescountry.togglePublished&format=raw",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(t)});(await e.json()).success?(UIkit.notification({message:"Status changed",status:"success",pos:"top-center",timeout:5e3}),this.selected=[],await this.filter()):UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},async togglePublished(t){this.selected=[],this.selected.push(t),this.toggleSelected()},selectAll(t){t.target.checked?this.selected=this.itemsChunked[this.currentPage]:this.selected=[]},async updateList(){const t=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=shippingratescountry.updatelist&format=raw&limit=0",{method:"post"});(await t.json()).success||UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},async filter(){this.loading=!0;const t={limit:this.show,offset:this.currentPage*this.show,country_id:this.selectedCountry,publishedOnly:this.publishedOnly},e=this.serialize(t),s=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=shippingratescountry.filter&format=raw&"+e,{method:"post"}),i=await s.json();i.success&&(this.items=i.data.items,this.loading=!1,this.items?this.changeShow():(this.itemsChunked=[],this.pages=1,this.currentPage=0))},changeShow(){this.itemsChunked=this.items.reduce(((t,e,s)=>{const i=Math.floor(s/this.show);return t[i]||(t[i]=[]),t[i].push(e),t}),[]),this.pages=this.itemsChunked.length,this.currentPage=0},changePage(t){this.currentPage=t},cleartext(){this.enteredText=null,this.doTextSearch()},async doTextSearch(t){clearTimeout(this.debounce),this.debounce=setTimeout((()=>{this.filter()}),600)},sort(t){return t===this.currentSort&&(this.currentSortDir="asc"===this.currentSortDir?"desc":"asc"),this.currentSort=t,this.itemsChunked[this.currentPage].sort(((t,e)=>{let s=1;return"desc"===this.currentSortDir&&(s=-1),t[this.currentSort]<e[this.currentSort]?-1*s:t[this.currentSort]>e[this.currentSort]?1*s:0}))},serialize(t){var e=[];for(var s in t)t.hasOwnProperty(s)&&e.push(encodeURIComponent(s)+"="+encodeURIComponent(t[s]));return e.join("&")}},components:{"p-inputswitch":primevue.inputswitch,"p-inputnumber":primevue.inputnumber}};Vue.createApp(p2s_shippingratescountry).mount("#p2s_shippingratescountries");