// @license   http://www.gnu.org/licenses/gpl.html GNU/GPL
const p2s_products={data:()=>({base_url:"",p2s_currency:"",p2s_local:"",items:[],itemsChunked:[],categories:[],selectedCategory:0,currentSort:"title",currentSortDir:"asc",currentPage:0,pages:[],pagesizes:[5,10,15,20,25,30,50,100,200,500],show:25,selected:[],confirm_LangString:"",changeCategory:0,showChangeCat:!1,showChangeStock:!1,changeStock:0,editStock:!1}),async beforeMount(){const e=document.getElementById("base_url");if(null!=e)try{this.base_url=e.innerText,e.remove()}catch(e){}const t=document.getElementById("currency");if(null!=t)try{this.p2s_currency=JSON.parse(t.innerText),t.remove()}catch(e){}const s=document.getElementById("locale");if(null!=s)try{this.p2s_local=s.innerText,s.remove()}catch(e){}const o=document.getElementById("items_data");this.items=JSON.parse(o.innerText),o.remove();const r=document.getElementById("categories_data");this.categories=JSON.parse(r.innerText),r.remove();const i=document.getElementById("page_size");this.show=i.innerText,i.remove();const a=document.getElementById("confirmLangString");try{this.confirm_LangString=a.innerText,a.remove()}catch(e){}},mounted:function(){this.changeShow()},computed:{},methods:{async updateList(){const e=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=product.updatelist&format=raw&limit=0",{method:"post"});(await e.json()).success||UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},async filter(){this.loading=!0;const e={limit:this.show,offset:this.currentPage*this.show,category:this.selectedCategory,searchTerm:this.enteredText?this.enteredText.trim():""},t=this.serialize(e),s=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=product.filter&format=raw&"+t,{method:"post"}),o=await s.json();o.success&&(this.items=o.data.items,this.loading=!1,this.items?this.changeShow():(this.itemsChunked=[],this.pages=1,this.currentPage=0))},changeShow(){this.itemsChunked=this.items.reduce(((e,t,s)=>{const o=Math.floor(s/this.show);return e[o]||(e[o]=[]),e[o].push(t),e}),[]),this.pages=this.itemsChunked.length,this.currentPage=0},changePage(e){this.currentPage=e},async doTextSearch(e){this.enteredText=null,clearTimeout(this.debounce),this.debounce=setTimeout((()=>{this.enteredText=e.target.value,this.filter()}),600)},sort(e){return e===this.currentSort&&(this.currentSortDir="asc"===this.currentSortDir?"desc":"asc"),this.currentSort=e,this.itemsChunked[this.currentPage].sort(((e,t)=>{let s=1;return"desc"===this.currentSortDir&&(s=-1),e[this.currentSort]<t[this.currentSort]?-1*s:e[this.currentSort]>t[this.currentSort]?1*s:0}))},async toggleSelected(){const e={items:this.selected},t=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=product.togglePublished&format=raw",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)});(await t.json()).success?(this.selected=[],await this.filter()):UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},async togglePublished(e){this.selected=[],this.selected.push(e),await this.toggleSelected()},async trashSelected(){await UIkit.modal.confirm(this.confirm_LangString);const e={items:this.selected},t=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=product.trash&format=raw",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)});(await t.json()).success?(this.selected=[],await this.filter()):UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},openChangeCategory(){this.showChangeCat=!this.showChangeCat},openChangeStock(){this.showChangeStock=!this.showChangeStock},async runChangeCategory(){if(this.selected.length>0){const e={items:this.selected,category_id:this.changeCategory},t=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=product.changeCategory&format=raw",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)});(await t.json()).success?(this.showChangeCat=!1,UIkit.notification({message:"Done",status:"success",pos:"top-right",timeout:5e3}),this.selected=[],await this.filter()):UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})}},async runChangeStock(){if(this.selected.length>0){const e={items:this.selected,stock:this.changeStock},t=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=product.changeStock&format=raw",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)});(await t.json()).success?(this.showChangeStock=!1,UIkit.notification({message:"Done",status:"success",pos:"top-right",timeout:5e3}),this.selected=[],await this.filter()):UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})}},openEditStock(e){e.editStock=!0},openEditPrice(e){e.editPrice=!0},async saveProductStock(e){delete e.editStock;const t={itemid:e.joomla_item_id,stock:e.stock},s=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=product.saveStock&format=raw",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(t)});(await s.json()).success?(UIkit.notification({message:"Done",status:"success",pos:"top-right",timeout:5e3}),await this.filter()):UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},updateBasePriceFloat(e,t){t.basepriceFloat=e.value},async saveProductPrice(e){delete e.editPrice;const t={itemid:e.joomla_item_id,base_priceFloat:e.basepriceFloat},s=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=product.savePrice&format=raw",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(t)});(await s.json()).success?(UIkit.notification({message:"Done",status:"success",pos:"top-right",timeout:5e3}),await this.filter()):UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},selectAll(e){e.target.checked?this.selected=this.itemsChunked[this.currentPage]:this.selected=[]},serialize(e){var t=[];for(var s in e)e.hasOwnProperty(s)&&t.push(encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t.join("&")},async exportSelected(){var e="object"!=typeof this.selected?JSON.parse(this.selected):this.selected,t="",s="";for(var o in e[0])s+=o+",";t+=(s=s.slice(0,-1))+"\r\n";for(var r=0;r<e.length;r++){s="";for(var o in e[r])s+='"'+e[r][o]+'",';s.slice(0,s.length-1),t+=s+"\r\n"}if(""!=t){var i=document.createElement("a");i.id="lnkDwnldLnk",document.body.appendChild(i),blob=new Blob([t],{type:"text/csv"});var a=window.webkitURL.createObjectURL(blob);i.setAttribute("download","Pro2Store_products.csv"),i.href=a,i.click(),document.body.removeChild(i)}else alert("Invalid data")}},components:{"p-inputnumber":primevue.inputnumber}};Vue.createApp(p2s_products).mount("#p2s_products");