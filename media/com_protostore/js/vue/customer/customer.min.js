// @license   http://www.gnu.org/licenses/gpl.html GNU/GPL
const p2s_customer_form={data:()=>({base_url:"",form:{jform_id:"",jform_name:"",jform_email:"",jform_j_user_id:"",jform_published:"",jform_j_user:[],jform_orders:[],jform_total_orders:"",jform_order_total_integer:0,jform_addresses:[]},countries:[],andClose:!1,deleteConfirmMessage:""}),mounted(){},computed:{},async beforeMount(){this.setData();const e=document.getElementById("jform_data");try{this.jform=JSON.parse(e.innerText)}catch(e){}const t=document.getElementById("base_url");try{this.base_url=t.innerText}catch(e){}const s=document.getElementById("currency");try{this.currency=s.innerText}catch(e){}const o=document.getElementById("locale");try{this.locale=o.innerText}catch(e){}const r=document.getElementById("deleteConfirmMessage");try{this.deleteConfirmMessage=r.innerText,r.remove()}catch(e){}},methods:{async saveItem(){console.log(this.form.jform_published);let e=new Object;e.id=this.form.jform_id,e.name=this.form.jform_name,e.email=this.form.jform_email,e.j_user_id=this.form.jform_j_user_id,e.published=this.form.jform_published?1:0;const t={customer:JSON.stringify(e)},s=this.serialize(t),o=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=customer.save&format=raw&"+s);(await o.json()).success?(UIkit.notification({message:"Saved!",status:"success",pos:"top-right",timeout:5e3}),this.andClose&&(window.location.href=this.base_url+"index.php?option=com_protostore&view=customers")):UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},editAddress(e){e.edit=!0,this.getZones(e)},async saveAddress(e){e.edit=!1,delete e.zones;const t={address:JSON.stringify(e)},s=this.serialize(t),o=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=address.save&format=raw&"+s);(await o.json()).success&&(this.updateAddresses(),UIkit.notification({message:"Saved!",status:"success",pos:"top-right",timeout:5e3}))},async updateAddresses(){const e={customer_id:this.form.jform_id},t=this.serialize(e),s=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=address.getCustomerAddressList&format=raw&"+t),o=await s.json();o.success&&(this.form.jform_addresses=o.data)},async getZones(e){const t={country_id:e.country},s=this.serialize(t),o=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=address.getZones&format=raw&"+s),r=await o.json();r.success&&(e.zones=r.data)},async launchDeleteDialog(){await UIkit.modal.confirm("<h3>"+this.deleteConfirmMessage+"</h3>");const e={user_id:this.form.jform_j_user_id,customer_id:this.form.jform_id},t=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=customer.delete&format=raw",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)});(await t.json()).success&&(UIkit.notification({message:"done",status:"success",pos:"top-right",timeout:5e3}),window.location.href=this.base_url+"index.php?option=com_protostore&view=customers")},setData(){Object.keys(this.form).forEach((e=>{let t=document.getElementById(e+"_data");t&&(this.hasJsonStructure(t.innerText)?this.form[e]=JSON.parse(t.innerText):(this.form[e]=t.innerText,1==t.innerText&&(this.form[e]=!0),0==t.innerText&&(this.form[e]=!1)),t.remove())}))},hasJsonStructure(e){if("string"!=typeof e)return!1;try{const t=JSON.parse(e),s=Object.prototype.toString.call(t);return"[object Object]"===s||"[object Array]"===s}catch(e){return!1}},serialize(e){var t=[];for(var s in e)e.hasOwnProperty(s)&&t.push(encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t.join("&")}},components:{"p-inputswitch":primevue.inputswitch}};Vue.createApp(p2s_customer_form).mount("#p2s_customer_form");