// @license   http://www.gnu.org/licenses/gpl.html GNU/GPL
const p2s_order_form={data:()=>({base_url:"",order:[],andClose:!1,newNoteText:"",emailActive:!1,emailTrackingActive:!1}),mounted(){},computed:{},async beforeMount(){const e=document.getElementById("base_url");this.base_url=e.innerText,e.remove();const t=document.getElementById("currency");t&&(this.currency=JSON.parse(t.innerText)),t.remove();const o=document.getElementById("locale");o&&(this.locale=o.innerText),o.remove();const s=document.getElementById("p2s_order");try{this.order=JSON.parse(s.innerText),s.remove()}catch(e){}},methods:{async getOrder(){const e={orderid:this.order.id},t=this.serialize(e),o=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=order.get&format=raw&"+t),s=await o.json();s.success?this.order=s.data:UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},async saveItem(){const e={itemid:this.form.jform_id},t=this.serialize(e),o=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=order.save&format=raw&"+t);(await o.json()).success?UIkit.notification({message:"Saved!",status:"success",pos:"top-right",timeout:5e3}):UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},copyOrderToClipboard(){let e="";for(const[t,o]of Object.entries(this.order))e+=` ${t}: ${o} `;this.copyToClipboard(e)},copyToClipboard(e){const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)},togglePaid(){console.log(this.order)},async sendEmail(e){const t={orderid:this.order.id,emailtype:e},o=this.serialize(t),s=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=order.sendemail&format=raw&"+o);(await s.json()).success?(this.getOrder(),UIkit.notification({message:"Saved!",status:"success",pos:"top-right",timeout:5e3})):UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},clearNote(){this.newNoteText=""},async saveNote(){const e={orderid:this.order.id,text:this.newNoteText},t=this.serialize(e),o=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=order.newnote&format=raw&"+t);(await o.json()).success?(this.getOrder(),await UIkit.modal("#addnotemodal").hide(),this.clearNote(),UIkit.notification({message:"Saved!",status:"success",pos:"top-right",timeout:5e3})):UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},async changeStatus(e){await UIkit.modal.confirm("Are you sure?");const t={order_id:this.order.id,status:e,sendEmail:this.emailActive},o=this.serialize(t),s=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=order.updatestatus&format=raw&"+o);(await s.json()).success?(this.getOrder(),UIkit.notification({message:"Saved!",status:"success",pos:"top-right",timeout:5e3})):UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},async saveTracking(){await UIkit.modal.confirm("Are you sure?");const e={order_id:this.order.id,tracking_code:this.order.tracking_code,tracking_link:this.order.tracking_link,tracking_provider:this.order.tracking_provider,sendEmail:this.emailTrackingActive},t=this.serialize(e),o=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=order.updatetracking&format=raw&"+t);(await o.json()).success?(this.getOrder(),UIkit.notification({message:"Saved!",status:"success",pos:"top-right",timeout:5e3})):UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},async togglePaid(){const e={order_id:this.order.id},t=this.serialize(e),o=await fetch(this.base_url+"index.php?option=com_ajax&plugin=protostore_ajaxhelper&method=post&task=task&type=order.togglepaid&format=raw&"+t);(await o.json()).success?(this.getOrder(),UIkit.notification({message:"Saved!",status:"success",pos:"top-right",timeout:5e3})):UIkit.notification({message:"There was an error.",status:"danger",pos:"top-center",timeout:5e3})},setData(){Object.keys(this.form).forEach((e=>{let t=document.getElementById(e+"_data");t&&(this.form[e]=t.innerText,t.remove())}))},serialize(e){var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")}},components:{"p-inputswitch":primevue.inputswitch,"p-timeline":primevue.timeline,"p-avatar":primevue.avatar}};Vue.createApp(p2s_order_form).mount("#p2s_order_form");